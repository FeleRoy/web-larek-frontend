# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Размещение в сети
Рабочая версия магазина доступна по адресу: https://

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Страница

```

interface IPage {
    BasketCounter: string
    Catalog: IProduct[];
}
```

Товар

```

interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

Интерфейс для модели данных продуктов

```

interface IProductsData {
    products: IProduct[];
    preview: string | null;
    tobasket: string | null;
}
```

Контакты покупателя

```

interface Contacts {
    payment: string;
    email: string;
    phone: string;
    address: string;
}
```

Данные товара, используемые в карточке

```

type TProductCard = Pick<IProduct, 'category' | 'title' | 'image' | 'price'>;
```

Данные товара, используемые в модальном окне описания

```

type TProductDescription = Pick<IProduct, 'category' | 'title' | 'image' | 'price' | 'description'>;
```

Данные товара, используемые в корзине

```

type TProductBasket = {
    index: number;
    title: string;
    price: number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой данных, отвечает за хранение и изменение данных,
- слой представления, отвечает за отображение данных на странице,
- слой презентер, отвечает за связь представления и данных.

### Базовый код


#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Конструктор:

- `constructor(baseUrl: string, options: RequestInit = {})`- принимает базовый URL и глобальные опции для всех запросов(опционально).

Методы: 
- `get(uri: string)` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse(response: Response): Promise<object> ` - метод для обработки ответа с сервера



#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 
- `onAll` - слушать все события
- `offAll` - сбросить все обработчики

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными товаров\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- _products: IProduct[] - массив объектов товаров
- _select: string | null - id товара, выбранного для просмотра описания или для добавления в корзину 
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- addProduct(product: IProduct): void - добавляет один товар в массив 
- addProducts(products: IProduct[]): void - добавляет массив товаров
- selectProduct(id: string):void - сохраняет id выбранного товара
- getProduct(productId: string): IProduct - возвращает товар по `id`

#### Класс ContactsData
Класс отвечает за хранение и логику работы с данными покупателя.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- payment: string - способ оплаты
- email: string - почта покупателя
- phone: string - телефон покупателя
- address: string - адрес доставки

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- checkValidation(data: Record<keyof Contacts, string>): boolean - проверяет объект с данными покупателя на валидность

#### Класс BasketModal
Класс отвечает за хранение и логику работы с данными в корзине.\
Конструктор класса принимает инстант брокера событий\
- items: IProduct[] - массив товаров, находящихся в корзине
- total: number - сумма покупки
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- addProduct(product: IProduct): void - добавление товара в массив 
- removeProduct(product: IProduct): void - удаления товара из массива
- containProduct(id: string):boolean - проверяет есть ли элемент в корзине
- calculateTotal():number - считает цену корзины

### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый класс Component
Это базовый класс в котором будут все необходимые методы управления DOM-элементами. Остальные классы будут его наследовать

Конструктор:

- `protected constructor(protected readonly container: HTMLElement)`

Методы:
- toggleClass(element: HTMLElement, className: string, force?: boolean) - для переключения класса элемента
- protected setText(element: HTMLElement, value: unknown) - для установки текстового содержимого
- setDisabled(element: HTMLElement, state: boolean) - для смены статуса блокировки
- protected setHidden(element: HTMLElement) - для скрытия элемента
- protected setVisible(element: HTMLElement) - для показа элемента
- protected setImage(element: HTMLImageElement, src: string, alt?: string) - для установки изображения
- render(data?: Partial\<T>): HTMLElement - для возвращения корневого элемента



#### Класс Page

Данный класс отвечает за отображение данных страницы: список карточек, корзину, кол-во товаров в корзине.

Поля класса содержат элементы разметки элементов страницы. Конструктор, кроме контейнера, принимает экземпляр `EventEmitter` для инициации событий.

- `constructor(container: HTMLElement, event: IEvents)`

Методы класса:

- set Сatalog(products: IProduct[]): void — отображает карточки товаров
- set BasketCounter(newBasketCounter: string): void — устанавливает значение счётчика товаров в корзине


#### Класс Card

Отвечает за отображение товара на сайте, задавая в карточке данные. 

Поля класса содержат элементы разметки элементов карточки и функции колбеки. Конструктор, кроме темплейта, принимает экземпляр `EventEmitter` для инициации событий.

- `constructor(container: HTMLElement, event: IEvents)`

Методы:
- setData(productData: IProduct): void - заполняет атрибуты элементов карточки
- render(): HTMLElement - возвращает заполненную карточку с установленными слушателями
- getId(): string - возвращает id товара
- setBasketIndex(index: number): void - устанавливает значение индекса в корзине   
- disableButton():void - отключает кнопку добавления в корзину

#### Класс Modal

Класс отвечает за отображение и управление модальными окнами. Методы `open` и `close` контролируют отображение окна. Установлены слушатели для закрытия окна при клике на оверлей или крестик.

Поля класса содержат элемент модального окна. Конструктор, кроме селектора для идентификации модального окна на странице, принимает экземпляр `EventEmitter` для инициации событий.

- `constructor(selector: string, event: IEvents)`

Методы:
- open(content: HTMLElement): void — заполняет элементы модального окна
- close(): void — очищает содержимое модального окна при закрытии

#### Класс Form
Класс отвечает за управлением логикой форм, отображаемых в модальном окне. Он обрабатывает поля формы, валидирует их, управляет состоянием кнопки отправки и генерирует события при отправке.

Поля класса содержат элемент формы и кнопку отправки. Конструктор, кроме темплейта, принимает экземпляр `EventEmitter` для инициации событий.

- `constructor(container: HTMLElement, event: IEvents)`

Методы:
- isValid(): boolean — проверяет, заполнены ли все обязательные поля формы и активирует кнопку
- clear(): void - очищает содержимое формы и деактивирует кнопку отправки

#### Класс Basket

Класс отвечает за управление отображением корзины товаров в модальном окне и взаимодействием с её содержимым. Корзина отображает список добавленных товаров, их стоимость и общую cумму

Поля класса содержат контейнер для списка товаров в корзине, элемент для отображения общей стоимости товаров и кнопку оформления. Конструктор, кроме темплейта, принимает экземпляр `EventEmitter` для инициации событий.

- `constructor(container: HTMLElement, event: IEvents)`

Методы:
- addProducts(data: IProduct[]): void — добавляет товары в корзину, используя шаблон 
- removeProduct(productId: string): void — удаляет товар из корзины по его id
- setPrice(totalPrice: number):void - устанавливает значение цены корзины
- toggleButton():void - включает и отключает кнопку оформления

#### Класс OrderSuccess

Класс отвечает за отображение сообщения об успешной покупке

Поля класса содержат элемент для отображения итоговой суммы заказа и кнопку для закрытия модального окна. Конструктор, кроме темплейта, принимает экземпляр `EventEmitter` для инициации событий.

- `constructor(container: HTMLElement, event: IEvents)`

Методы:
- setDescription(description: string):void - устанавливает значение описанию

### Слой коммуникации

#### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `product:selected` - изменение открываемой в модальном окне карточки
- `product:previewClear` - необходима очистка данных выбранной для показа в модальном окне карточки товара
- `basket:additem` - добавление товара в корзину
- `basket:removeitem` - удаление товара из корзины

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `product:select` - выбор товара для отображения в модальном окне
- `product:tobasket` - нажатие на кнопку добавить
- `basket:open` - нажатие на кнопку корзины
- `basket:deleteproduct` - нажатие на кнопку удалить товар
- `basket:order` - нажатие на кнопку оформить
- `order:card` - способ оплаты онлайн
- `order:cash` - способ оплаты при получении
- `order:input` - изменение данных в форме с адресом доставки
- `order:validation` - событие, сообщающее о необходимости валидации формы адреса доставки
- `order:submit` - нажатие на кнопку далее
- `contacts:input` - изменение данных в форме с контакными данными
- `contacts:validation` - событие, сообщающее о необходимости валидации формы контактных данных
- `contacts:submit` - нажатие на кнопку оплатить
- `success:close` - нажатие на кнопку за новыми покупками